{% load staticfiles %}
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>home</title>
    <script src="{% static "/css/../../static/js/jquery-3.4.1.min.js" %}"></script>
    <script src="{% static "/css/../../static/js/echarts-en.min.js" %}"></script>
    <script src="{% static "/css/../../static/js/roma.js" %}"></script>
    <script src="{% static "/css/../../static/js/ph.js" %}"></script>
    <link rel="stylesheet" href="{% static "/css/message_5d7c4a8a.css" %}" type="text/css" id="messagelink">
    <link rel="stylesheet" href="{% static "/css/page_8d4e4a3.css" %}" type="text/css">
    <link rel="stylesheet" href="{% static "/css/bulma.css" %}" type="text/css">
    <link rel="stylesheet" href="{% static "/css/paper.css" %}" type="text/css">
    <link rel="stylesheet" href="{% static "/css/font-awesome-4.7.0/css/font-awesome.css" %}">
    <style type="text/css">
      html,body{margin:0;padding: 0;}
      /* 动态为footer添加类fixed-bottom */
      .fixed-bottom {position: fixed;bottom: 0;width:100%;}
    </style>
    <script type="text/javascript">
      $(function(){
          function footerPosition(){
              $("footer").removeClass("fixed-bottom");
              var contentHeight = document.body.scrollHeight,//网页正文全文高度
                  winHeight = window.innerHeight;//可视窗口高度，不包括浏览器顶部工具栏
              if(!(contentHeight > winHeight)){
                  //当网页正文高度小于可视窗口高度时，为footer添加类fixed-bottom
                  $("footer").addClass("fixed-bottom");
              } else {
                  $("footer").removeClass("fixed-bottom");
              }
          }
          footerPosition();
          $(window).resize(footerPosition);
      });
    </script>
</head>

<body>
    <div class="container">
        <div id="head_wr" class="gj ">
        <div id="head" class="LOG_WR gj " data-log="{&#39;actblock&#39;: &#39;head&#39;}">
                <div class="headCont ">
                    <div id="u" class="gj ">
                    </div>
                    <a href="/" class="s_logo">
                        <div class="s_logo_img" alt="到学术首页" title="到学术首页"></div>
                    </a>

                    <div class="s_form_wr">
                        <form class="fm" id="form" action="search_general" method="post">
                            <input type="text" style="display: none" id="aggregation" name="aggregation" value="True">
                            <div class="s_ipt_wr">
                                <input name="search_content" style="width: 450px" autocomplete="off" id="kw" value="{{ search_content }}" maxlength="256">
                                <i class="s_ipt_search_icon">
                                    <img src= '{% static '/png/search.png' %}' width="40px" height="45px">
                                </i>
                            </div>
                            <input type="submit" value="sub" style="display: none">
                        </form>

                        <div class="sc_adv_triangle_down gj" id="test">
                            <span><strong>Advanced</strong></span><i class="sc_adv_icon"></i>
                        </div>
                        <input id="search_type" style="display: none" value="{{ search_type }}">

                        <div id="sc_adv">
                            <form action="search_advanced" id="sc_adv_frm" method="post">
                                {% csrf_token %}
                                <input type="text" style="display: none" id="aggregation1" name="aggregation" value="True">
                                <div class="sc_adv_hatr">
                                    <span class="sc_adv_label">title</span>
                                    <span><input type="text" id="title" name="title" placeholder=""  data-type="all" data-name="" class="sc_adv_keyword_ipt sc-input sc_adv_keyword1" maxlength="100" value="{{ items.title }}"></span>
                                </div>
                                <div class="sc_adv_hatr">
                                    <span class="sc_adv_label">author name</span>
                                    <span><input type="text" id="author_name" name="author_name" placeholder="" data-type="precise" data-name="" class="sc_adv_keyword_ipt sc-input sc_adv_keyword2" maxlength="100" value="{{ items.author_name }}"></span>
                                </div>
                                <div class="sc_adv_hatr">
                                    <span class="sc_adv_label">author organization</span>
                                    <span><input type="text" id="author_org" name="author_org" placeholder="" data-type="or" data-name="" class="sc_adv_keyword_ipt sc-input" maxlength="100" value="{{ items.author_org }}"></span>
                                </div>
                                <div class="sc_adv_hatr">
                                    <span class="sc_adv_label">vneue</span>
                                    <span><input type="text" id="vneue" name="vneue" placeholder="" data-type="not" data-name="" class="sc_adv_keyword_ipt sc-input" maxlength="100" value="{{ items.vneue }}"></span>
                                </div>
                                <div class="sc_adv_hatr">
                                    <span class="sc_adv_label">keyword</span>
                                    <span><input type="text" id="keywords" name="keywords" placeholder="" data-type="not" data-name="" class="sc_adv_keyword_ipt sc-input" maxlength="100" value="{{ items.keywords }}"></span>
                                </div>
                                <div class="sc_adv_hatr">
                                    <span class="sc_adv_label">fos</span>
                                    <span><input type="text" id="fos" name="fos" placeholder="" data-name="author" class="sc_adv_txin sc-input sc_adv_author" maxlength="50" value="{{ items.fos }}"></span>
                                </div>
                                <div class="sc_adv_hatr">
                                    <span class="sc_adv_label">publisher</span>
                                    <span class="sc_adv_jour_conf">
                                        <span>
                                            <input type="text" id="publisher" name="publisher" placeholder="" data-name="journal" class="sc-input sc_adv_txin sc_adv_pubipt" maxlength="100" value="{{ items.publisher }}">
                                        </span>
                                </div>
                                <div class="sc_adv_hatr">
                                    <span class="sc_adv_label">issn</span>
                                    <span><input type="text" id="issn" name="issn" placeholder="" data-name="author" class="sc_adv_txin sc-input sc_adv_author" maxlength="50" value="{{ items.issn }}"></span>
                                </div>
                                <div class="sc_adv_hatr">
                                    <span class="sc_adv_label">doi</span>{{ items.title }}
                                    <span><input type="text" id="doi" name="doi" placeholder="" data-name="author" class="sc_adv_txin sc-input sc_adv_author" maxlength="50" value="{{ items.doi }}"></span>
                                </div>
                                <div class="sc_adv_hatr">
                                    <span class="sc_adv_label">url</span>
                                    <span><input type="text" id="url" name="url" placeholder="" data-name="author" class="sc_adv_txin sc-input sc_adv_author" maxlength="50" value="{{ items.url }}"></span>
                                </div>
                                <div class="sc_adv_hatr">
                                    <span class="sc_adv_label">abstract</span>
                                    <span><input type="text" id="abstract" name="abstract" placeholder="" data-name="author" class="sc_adv_txin sc-input sc_adv_author" maxlength="50" value="{{ items.abstract }}"></span>
                                </div>
                                <div class="sc_adv_hatr">
                                    <span class="sc_adv_label">year</span>
                                    <span><input type="text" id="year" name="year" data-nolog="1" pattern="[0-9]*" size="4"  maxlength="4" class="sc-input sc-input-xmini sc_adv_input_ylo" value="{{ items.year }}">
                                    </span>
                                </div>
                                <div class="sc_adv_hatr">
                                    <span class="sc_adv_label">language</span>
                                    <span><input type="text" id="language" name="language" placeholder="" data-name="author" class="sc-input sc-input-xmini sc_adv_lang_sel" maxlength="50" value="{{ items.lang }}"></span>
                                </div>
                                <span class="sc_adv_wd_hidden"></span>
                                <span class="sc_adv_sub s_btn_wr">
                                    <input id="advance_submit" type="submit" value="Search" class="sc_adv_sub_btn s_btn" >
                                </span>

                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="tile is-ancestor">
           <div class="tile is-vertical is-3">
               <div class="tile">
                   <div class="tile is-parent is-vertical">
                       <div class="tile is-child">
                           <br>
                           <br>
                           <aside class="menu">
                               <p class="menu-label" style="font-size: 16px">
                                   <span id="year_arrow">
                                       <i class="fa fa-caret-down"></i>
                                   </span>
                                   Year
                               </p>
                                <ul class="menu-list">
                                    <li>
                                        <ul id="menu_year">
                                            {% for year in years %}
                                                {% if forloop.counter < 4 %}
                                                    <li><a style="font-size: 15px">{{ year.key }}({{ year.doc_count }})</a></li>
                                                {% endif %}
                                                {% if forloop.counter == 4  %}
                                                    <li><a style="color: purple;font-size: 15px" id="year_show_more">Show More</a></li>
                                                {% endif %}
                                                {% if forloop.counter > 3 %}
                                                    <li style="display: none"><a style="font-size: 15px">{{ year.key }}({{ year.doc_count }})</a></li>
                                                {% endif %}
                                            {% endfor %}
                                        </ul>
                                    </li>
                                </ul>

                               <p class="menu-label" style="font-size: 16px">
                                   <span id="fos_arrow">
                                       <i class="fa fa-caret-down"></i>
                                   </span>
                                   Fos
                               </p>
                                    <ul class="menu-list">
                                    <li>
                                        <ul>
                                            {% for fos in foses %}
                                                {% if forloop.counter < 4 %}
                                                    <li>
                                                        <a class="is-black">
                                                            <input type="checkbox" style="width: 1.2em; height: 1.2em" value="{{ fos.id }}">
                                                            {{ fos.name }}({{ fos.count }})
                                                        </a>
                                                </li>
                                            {% endif %}
                                            {% if forloop.counter == 4  %}
                                                <li><a style="color: purple;font-size: 15px" id="fos_show_more">Show More</a></li>
                                            {% endif %}
                                            {% if forloop.counter > 3 %}
                                                <li style="display: none">
                                                    <a class="is-black">
                                                        <input type="checkbox" style="width: 1.2em; height: 1.2em" value="{{ fos.id }}">
                                                        {{ fos.name }}({{ fos.count }})
                                                    </a>
                                                </li>
                                            {% endif %}
                                        {% endfor %}
                                    </ul>
                            </ul>

                               <p class="menu-label" style="font-size: 16px">
                                   <span id="author_arrow">
                                       <i class="fa fa-caret-down"></i>
                                   </span>
                                   author
                               </p>
                                <ul class="menu-list">
                                    <li>
                                        <ul id="menu_author">
                                            {% for author in authors %}
                                                {% if forloop.counter < 4 %}
                                                    <li><a style="font-size: 15px">{{ author.key }}({{ author.doc_count }})</a></li>
                                                {% endif %}
                                                {% if forloop.counter == 4  %}
                                                    <li><a style="color: purple;font-size: 15px" id="author_show_more">Show More</a></li>
                                                {% endif %}
                                                {% if forloop.counter > 3 %}
                                                    <li style="display: none"><a style="font-size: 15px">{{ author.key }}({{ author.doc_count }})</a></li>
                                                {% endif %}
                                            {% endfor %}
                                        </ul>
                                </ul>

                               <p class="menu-label" style="font-size: 16px">
                                   <span id="publisher_arrow">
                                       <i class="fa fa-caret-down"></i>
                                   </span>
                                   publisher
                               </p>
                                <ul class="menu-list">
                                    <li>
                                        <ul id="menu_publisher">
                                            {% for publisher in publishers %}
                                                {% if forloop.counter < 4 %}
                                                    <li><a style="font-size: 15px">{{ publisher.key }}({{ publisher.doc_count }})</a></li>
                                                {% endif %}
                                                {% if forloop.counter == 4  %}
                                                    <li><a style="color: purple;font-size: 15px" id="publisher_show_more">Show More</a></li>
                                                {% endif %}
                                                {% if forloop.counter > 3 %}
                                                    <li style="display: none"><a style="font-size: 15px">{{ publisher.key }}({{ publisher.doc_count }})</a></li>
                                                {% endif %}
                                            {% endfor %}
                                        </ul>
                                </ul>
                        </aside>
                       </div>
                   </div>
               </div>
           </div>

           <div class="tile is-vertical is-6">
               <div>
                   <article class="media">
                        <div class="media-content">
                            <div class="content">
                                <div>
                                    <br>
                                    <span id="result_num" style="color: #777777;font-size: 15px"> About {{ result_num }} results</span>
                                    <div class="dropdown" style="float: right">
                                    <div class="dropdown-trigger">
                                            <a class="button is-small" style="width:7em" id="button_sort" aria-haspopup="true" aria-controls="dropdown-menu3">
                                            <span id="chosen_sort">Relevance</span>
                                            <span class="icon is-small">
                                                <i class="fas fa-angle-down" aria-hidden="true"></i>
                                            </span>
                                        </a>
                                    </div>

                                    <div class="dropdown-menu" style="width:6em" id="sort_list" role="menu">
                                        <div class="dropdown-content" style="width:6em">
                                            <a id="relevance_sort" style="width:6em; display: none" class="dropdown-item">
                                                Relevance
                                            </a>
                                            <a id="year_sort" style="width:6em; display: block" class="dropdown-item">
                                                Year
                                            </a>
                                            <a id="citation_sort" style="width:6em; display: block" class="dropdown-item">
                                                Citation
                                            </a>
                                        </div>
                                    </div>

                                </div>
                            </div>


                            <hr style="margin-top: 15px; margin-bottom: 10px">
                        </div>
                </div>
            </article>

        </div>
               <div id="papers">
                   {% for paper in paper_list %}
                   <article class="media">
                       <div class="media-content">
                           <div class="content">
                               <div class="abstract">
                                   <a href="/paper/get_paper_by_id?paper_id={{ paper.id }}" target="_blank" style="color: #0a0a0a">
                                       <strong style="font-size: 18px">{{ paper.title }}</strong>
                                   </a>
                               </div>
                               <div class="title" style="font-size: small;margin: 5px">
                                   {% for author in paper.authors %}
                                   <small><font color="green">{{ author.name }}</font>
                                        {% if not forloop.last %}
                                              ,
                                        {% endif %}
                                    </small>
                                   {% endfor %}
                               </div>
                            <p style="font-size: small;margin: 5px">{{ paper.publisher }},({{ paper.year }})&nbsp;&nbsp;
                                {% if "doi" in paper %}
                                    -doi:{{ paper.doi }}&nbsp;&nbsp;
                                {% endif %}
                                {% if "doi" in paper %}
                                    <a href='http://dx.doi.org/{{ paper.doi }}' target="_blank" style="color: #0a0a0a">
                                        <i class="fa fa-book"></i> ORIGINAL LINK
                                    </a>
                                {% endif %}
                            </p>
                            <p class="abstract" style="font-size: small;margin: 5px">
                                {{ paper.sub_abstract }}
                            </p>
                            {% if "n_citation" in paper %}
                                <p style="color:purple;font-size: 13px">Cited by {{ paper.n_citation }}</p>
                            {% endif %}
                        </div>
                    </div>
                </article>
            {% endfor %}
            </div>

               <div>
                   <br>
                   <br>
                   <br>
                    <nav class="pagination" role="navigation" aria-label="pagination">
                        <a class="pagination-previous" id="previous_page">Previous</a>
                        <a class="pagination-next" id="next_page">Next page</a>
                        <input id="page_num" style="display: none;" type="number" value={{ page_num }}>
                        <ul class="pagination-list" id="page_list">
                            {% for page_num in page_num_list %}
                                {% if forloop.first %}
                                    <li>
                                        <a class="pagination-link is-current" aria-current="page" aria-label="Goto page 1">1</a>
                                    </li>
                                {% else %}
                                <li>
                                    <a class="pagination-link"
                                        aria-label="Goto page {{ forloop.counter }}">{{ forloop.counter }}
                                    </a>
                                </li>
                                {% endif %}
                                {% if page_num > 9 %}
                                    <li>
                                        <span class="pagination-ellipsis">&hellip;</span>
                                    </li>
                                {% endif %}
                                {% endfor %}
                        </ul>
                    </nav>
               </div>

        </div>

           <div class="tile is-vertical is-3">
            <div class="tile">
                <div class="tile is-parent is-vertical">
                    <div class="tile is-child">
                        <br>
                        <br>
                        <div class="box">
                            <div id="year_chart" style="width: 450px;height:300px;"></div>
                            <div id="fos_chart" style="width: 450px;height:300px;"></div>
                            <div id="author_chart" style="width: 450px;height:300px;"></div>
                        </div>


                    </div>
                </div>
            </div>
        </div>
       </div>

        <footer>
            <hr>
            <div class="content">
                <p style="font-size: 0.8em">
                    2018 - 2018 ©  Team. All Rights Reserved. 关于我们<br>&nbsp;
                </p>
            </div>
        </footer>
    </div>

    <script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('year_chart'),"roma");

        // 指定图表的配置项和数据

        var year_list = {{ years|safe}};

        console.log(year_list);

        var year_name_list = [];
        var year_count_list = [];
        for(var index in year_list){
            year_name_list.unshift(year_list[index]['key']);
            year_count_list.unshift(year_list[index]['doc_count']);
        }
        var option = {
            title: {
                text: 'Popularity Over Time'
            },
            tooltip: {},
            legend: {
                data:['xx']
            },

            toolbox : {
			    show : true,
			    feature : {
				    magicType : {
					    show : true,
					    type : [ 'line', 'bar'],
				    },
                    dataView: { show: true, readOnly: false },
				    saveAsImage : {
					    show : true,
					    title : 'Save',
					    type : 'png',
					    lang : [ '点击保存' ]
				    }
			    }
            },
            xAxis: {
                    name:'Year',
                data: year_name_list
            },
            yAxis: {
                name: 'Papers',
                axisLabel: {
                    margin: 7,
                    formatter: function (value, index) {
                        if (value >= 1000 && value < 1000000) {
                            value = value / 10000 + "K";
                        } else if (value >= 1000000) {
                            value = value / 1000000 + "M";
                        }
                        return value;
                    }
                }
            },
            series: [{
                type: 'bar',
                data: year_count_list,
                itemStyle:{normal:{label:{show:false}}},
                label: {
			      normal: {
			          show: false,
			          position: 'top',
			          textStyle: {
			            color: 'black'
			          }
			      }
			 }
            }]
        };

        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    </script>
    <script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('fos_chart'),"roma");

        var fos_list = {{ foses|safe}};


        var fos_name_list = [];
        var fos_count_list = [];
        for(var index in fos_list){
            fos_name_list.push(fos_list[index]['name']);
            fos_count_list.push(fos_list[index]['count']);
        }
        // 指定图表的配置项和数据
        var option = {
            title: {
                text: 'Popularity Over Fos'
            },
            tooltip: {},
            legend: {
                data:['xx']
            },
            toolbox : {
			    show : true,
			    feature : {
				    magicType : {
					    show : true,
					    type : [ 'line', 'bar'],
				    },
                    dataView: { show: true, readOnly: false },
				    saveAsImage : {
					    show : true,
					    title : 'Save',
					    type : 'png',
					    lang : [ '点击保存' ]
				    }
			    }
            },
            xAxis: {
                name:'Fos',
                data: fos_name_list,
                axisLabel: {
                    interval: 0,
                    rotate: 50,
                     formatter: function(value) {
                        if (value.length > 10) {
                            return value.substring(0, 10) + "...";
                        } else {
                            return value;}
                    }
                }
            },
            yAxis: {
                name:'Papers',
                axisLabel: {
                    margin: 7,
                    formatter: function (value, index) {
                        if (value >= 1000 && value < 1000000) {
                            value = value / 10000 + "K";
                        } else if (value >= 1000000) {
                            value = value / 1000000 + "M";
                        }
                return value;
            }
        },
            },
             grid: {
                y2:'35',
                left: '10%',
                bottom:'30%'
            },
            series: [{
                type: 'line',
                data: fos_count_list,
                itemStyle:{normal:{label:{show:false}}},
                label: {
			      normal: {
			          show: false,
			          position: 'top',
			          textStyle: {
			            color: 'black'
			          }
			      }
			 }
            }]
        };

        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    </script>
    <script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('author_chart'),"roma");

        var author_list = {{ authors|safe}};

        var author_name_list = [];
        var author_paper_count_list = [];
        for(var index in author_list){
            console.log(author_list[index]['key']);
            author_name_list.push(author_list[index]['key']);
            author_paper_count_list.push(author_list[index]['doc_count']);
        }


        // 指定图表的配置项和数据
        var option = {
            title: {
                text: 'Top Authors'
            },
            tooltip: {},
            legend: {
                data:['xx']
            },
            xAxis: {
                name:'Author',
                data: author_name_list,
                axisLabel: {
                    interval: 0,
                    rotate: 50,
                     formatter: function(value) {
                        if (value.length > 10) {
                            return value.substring(0, 10) + "...";
                        } else {
                            return value;}
                    }
                },
            },

             toolbox : {
			    show : true,
			    feature : {
				    magicType : {
					    show : true,
					    type : [ 'line', 'bar'],
				    },
                    dataView: { show: true, readOnly: false },
				    saveAsImage : {
					    show : true,
					    title : 'Save',
					    type : 'png',
					    lang : [ '点击保存' ]
				    }
			    }
            },
            grid: {
                y2:45,
                left: '10%',
                bottom:'30%'
            },
            yAxis: {
                name: 'Papers',
                axisLabel: {
                    margin: 7,
                    formatter: function (value, index) {
                        if (value >= 1000 && value < 1000000) {
                            value = value / 1000 + "K";
                        } else if (value >= 1000000) {
                            value = value / 1000000 + "M";
                        }
                        return value;
                    }
                }
            },
            series: [{
                type: 'bar',
                data: author_paper_count_list,
                itemStyle:{normal:{label:{show:false}}},
                label: {
			      normal: {
			          show: false,
			          position: 'top',
			          textStyle: {
			            color: 'black'
			          }
			      }
			 }
            }]
        };

        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    </script>
</body>
</html>